import { Callout } from "nextra/components";
import { Cards, Card } from "nextra/components";
import { Steps } from "nextra/components";
import { Tabs, Tab } from "nextra/components";

# тЪб React flushSync: рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ

## flushSync ржХрж┐? ЁЯдФ

React рж╕рж╛ржзрж╛рж░ржгржд ржнрж╛рж▓ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕рзЗрж░ ржЬржирзНржп рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯржЧрзБрж▓рзЛ ржмрзНржпрж╛ржЪ ржХрж░рзЗ ЁЯУжред ржХрж┐ржирзНрждрзБ ржХржЦржиржУ ржХржЦржиржУ, ржЖржкржирж╛рж░ DOM-ржХрзЗ ржЕржмрж┐рж▓ржорзНржмрзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржпрж╝ тЪб - ржпрзЗржоржи ржпржЦржи ржЖржкржирж┐ ржирждрзБржи ржпрзЛржЧ ржХрж░рж╛ ржЖржЗржЯрзЗржорзЗ рж╕рзНржХрзНрж░рж▓ ржХрж░ржЫрзЗржи ЁЯУЬ ржмрж╛ рж╕рзНржЯрзЗржЯ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрж░ржкрж░ржЗ ржПрж▓рж┐ржорзЗржирзНржЯрзЗрж░ ржорж╛рждрзНрж░рж╛ ржкрж░рж┐ржорж╛ржк ржХрж░ржЫрзЗржи ЁЯУПред

<Callout type="info" emoji="ЁЯТб">
  **flushSync** React-ржХрзЗ ржпрзЗржХрзЛржирзЛ ржкрзЗржирзНржбрж┐ржВ ржЖржкржбрзЗржЯ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ржнрж╛ржмрзЗ ржлрзНрж▓рж╛рж╢ ржХрж░рждрзЗ ржмрж╛ржзрзНржп ржХрж░рзЗ,
  ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ DOM ржЕржмрж┐рж▓ржорзНржмрзЗ ржЖржкржбрзЗржЯ рж╣ржмрзЗред
</Callout>

## рж╕ржорж╕рзНржпрж╛: ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ

ржПржЦрж╛ржирзЗ ржПржХржЯрж┐ рж╕рж╛ржзрж╛рж░ржг ржкрж░рж┐рж╕рзНржерж┐рждрж┐ ржпрж╛ ржкрзНрж░рждрзНржпрж╛рж╢рж┐рждржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ ржирж╛:

```jsx filename="TodoList.jsx" {3}
function addTodo() {
  setTodos([...todos, newTodo]);
  listRef.current.lastChild.scrollIntoView(); // тЭМ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛!
}
```

<Callout type="error">
  `scrollIntoView()` ржХрж▓ ржХрж░рж╛ рж╣рж▓рзЗ ржирждрзБржи todo ржЖржЗржЯрзЗржоржЯрж┐ DOM-ржП ржПржЦржиржУ ржирзЗржЗ, рждрж╛ржЗ
  рж╕рзНржХрзНрж░рж▓ ржЖржЪрж░ржгржЯрж┐ ржЕрж╕ржЩрзНржЧрждрж┐ржкрзВрж░рзНржгред
</Callout>

## рж╕ржорж╛ржзрж╛ржи: flushSync рж╕рж╛рж╣рж╛ржпрзНржпрзЗ! ЁЯж╕тАНтЩАя╕П

<Tabs items={['рж╕ржорж╕рзНржпрж╛', 'рж╕ржорж╛ржзрж╛ржи']}>
  <Tab>
    ```jsx
    // тЭМ ржПржЯрж┐ ржирж┐рж░рзНржнрж░ржпрзЛржЧрзНржпржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ ржирж╛
    function addTodo() {
      setTodos([...todos, newTodo]);
      // DOM ржПржЦржиржУ ржЖржкржбрзЗржЯ рж╣ржпрж╝ржирж┐!
      listRef.current.lastChild.scrollIntoView();
    }
    ```
  </Tab>
  <Tab>
    ```jsx
    import { flushSync } from 'react-dom';
    
    // тЬЕ ржПржЯрж┐ ржкрзБрж░рзЛржкрзБрж░рж┐ ржХрж╛ржЬ ржХрж░рзЗ!
    function addTodo() {
      flushSync(() => {
        setTodos([...todos, newTodo]);
      });
      // DOM ржПржЦржи ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ!
      listRef.current.lastChild.scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
      });
    }
    ```
  </Tab>
</Tabs>

## рж╕ржорзНржкрзВрж░рзНржг ржЙржжрж╛рж╣рж░ржг

ржПржЦрж╛ржирзЗ ржПржХржЯрж┐ ржЯрзБржбрзБ рж▓рж┐рж╕рзНржЯрзЗрж░ рж╕ржорзНржкрзВрж░рзНржг ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржпрж╛ ржирждрзБржи ржЖржЗржЯрзЗржоржЧрзБрж▓рж┐рждрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ рж╕рзНржХрзНрж░рж▓ ржХрж░рзЗ:

```jsx filename="TodoList.jsx" showLineNumbers
import { useState, useRef } from "react";
import { flushSync } from "react-dom";

export default function TodoList() {
  const listRef = useRef(null);
  const [text, setText] = useState("");
  const [todos, setTodos] = useState(initialTodos);

  function handleAdd() {
    if (!text.trim()) return;

    const newTodo = {
      id: Date.now(),
      text: text.trim(),
    };

    // ЁЯФе ржПржЦрж╛ржирзЗ ржЬрж╛ржжрзБ ржШржЯрзЗ
    flushSync(() => {
      setText("");
      setTodos([...todos, newTodo]);
    });

    // DOM ржПржЦржи ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ ржирж┐рж╢рзНржЪрж┐ржд
    listRef.current.lastChild.scrollIntoView({
      behavior: "smooth",
      block: "nearest",
    });
  }

  return (
    <div className="max-w-md mx-auto p-6">
      <div className="mb-4">
        <input
          type="text"
          value={text}
          onChange={(e) => setText(e.target.value)}
          onKeyDown={(e) => e.key === "Enter" && handleAdd()}
          placeholder="Add a new todo..."
          className="w-full p-3 border rounded-lg"
        />
        <button
          onClick={handleAdd}
          className="w-full mt-2 p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
        >
          Add Todo тЮХ
        </button>
      </div>

      <div className="h-64 overflow-y-auto border rounded-lg p-4">
        <ul ref={listRef} className="space-y-2">
          {todos.map((todo) => (
            <li key={todo.id} className="p-3 bg-gray-50 rounded border">
              {todo.text}
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}

// ржкрзНрж░рж╛ржержорж┐ржХ ржбрзЗржЯрж╛
const initialTodos = Array.from({ length: 20 }, (_, i) => ({
  id: i,
  text: `Todo item #${i + 1}`,
}));
```

## ржХржЦржи flushSync ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи

<Cards>
  <Card icon="ЁЯУП" title="DOM ржорж╛ржк" href="#">
    ржпржЦржи рж╕рзНржЯрзЗржЯ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрж░ржкрж░ржЗ ржПрж▓рж┐ржорзЗржирзНржЯрзЗрж░ ржорж╛рждрзНрж░рж╛ ржкрж░рж┐ржорж╛ржк ржХрж░рждрзЗ рж╣ржпрж╝
  </Card>
  <Card icon="ЁЯОп" title="рж╕рзНржХрзНрж░рж▓рж┐ржВ ржПржмржВ ржлрзЛржХрж╛рж╕" href="#">
    ржЖржкржбрзЗржЯрзЗрж░ ржкрж░ржкрж░ржЗ ржирждрзБржи ржПрж▓рж┐ржорзЗржирзНржЯрзЗ рж╕рзНржХрзНрж░рж▓ ржмрж╛ ржЗржиржкрзБржЯ ржлрзЛржХрж╛рж╕ ржХрж░рж╛рж░ ржЬржирзНржп
  </Card>
  <Card icon="ЁЯОи" title="ржЕрзНржпрж╛ржирж┐ржорзЗрж╢ржи" href="#">
    DOM ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░рж╢рзАрж▓ ржЕрзНржпрж╛ржирж┐ржорзЗрж╢ржи рж╕ржоржирзНржмржпрж╝ ржХрж░рж╛рж░ рж╕ржоржпрж╝
  </Card>
  <Card icon="ЁЯФД" title="рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи" href="#">
    ржЕржмрж┐рж▓ржорзНржмрзЗ DOM ржЖржкржбрзЗржЯ ржкрзНрж░ржпрж╝рзЛржЬржи ржПржоржи рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ржЧрзБрж▓рж┐рж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи
  </Card>
</Cards>

## рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи ржПржмржВ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЯрж┐ржкрж╕

<Steps>
### рж╕рзАржорж┐ржд ржмрзНржпржмрж╣рж╛рж░
ржЕрждрж┐рж░рж┐ржХрзНржд ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ flushSync ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржХрзНрж╖рждрж┐ржЧрзНрж░рж╕рзНржд ржХрж░рждрзЗ ржкрж╛рж░рзЗред рж╢рзБржзрзБржорж╛рждрзНрж░ ржпржЦржи рж╕рждрзНржпрж┐ржЗ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ ржЖржкржбрзЗржЯ ржкрзНрж░ржпрж╝рзЛржЬржи рждржЦржиржЗ ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

### ржПржХрж╛ржзрж┐ржХ ржЖржкржбрзЗржЯ ржмрзНржпрж╛ржЪ ржХрж░рзБржи

ржпржжрж┐ ржПржХрж╛ржзрж┐ржХ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕ рж╣ржУржпрж╝рж╛ ржкрзНрж░ржпрж╝рзЛржЬржи, рждрж╛рж╣рж▓рзЗ рж╕рзЗржЧрзБрж▓рж┐ ржПржХржЯрж┐ flushSync ржХрж▓рзЗрж░ ржоржзрзНржпрзЗ рж░рж╛ржЦрзБржи:

```jsx
flushSync(() => {
  setCount(count + 1);
  setName("New name");
  setItems([...items, newItem]);
});
```

### ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗ ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи

ржкрзНрж░рждрж┐ржЯрж┐ ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗ flushSync ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи ржирж╛ - ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕рзЗрж░ ржЬржирзНржп рж╕рж╛ржзрж╛рж░ржгржд React-ржПрж░ ржмрзНржпрж╛ржЪрж┐ржВ ржнрж╛рж▓ред

</Steps>

<Callout type="warning" emoji="тЪая╕П">
  **ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ рж╕рждрж░рзНржХрждрж╛**: flushSync React-ржПрж░ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи ржмрж╛ржЗржкрж╛рж╕ ржХрж░рзЗред рж╢рзБржзрзБржорж╛рждрзНрж░ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣рж▓рзЗ ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи!
</Callout>

## рж╕рж╛ржзрж╛рж░ржг ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржХрзНрж╖рзЗрждрзНрж░

### ржирждрзБржи ржХржирзНржЯрзЗржирзНржЯрзЗ рж╕рзНржХрзНрж░рж▓рж┐ржВ

```jsx
function addMessage(message) {
  flushSync(() => {
    setMessages((prev) => [...prev, message]);
  });

  // ржирждрзБржи ржорзЗрж╕рзЗржЬрзЗ рж╕рзНржХрзНрж░рж▓
  chatRef.current.scrollTop = chatRef.current.scrollHeight;
}
```

### ржлрзЛржХрж╛рж╕ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ

```jsx
function addInput() {
  flushSync(() => {
    setInputs((prev) => [...prev, { id: Date.now(), value: "" }]);
  });

  // ржирждрзБржи ржпрзЛржЧ ржХрж░рж╛ ржЗржиржкрзБржЯрзЗ ржлрзЛржХрж╛рж╕
  const newInput = document.getElementById(`input-${inputs.length}`);
  newInput?.focus();
}
```

### ржЕрзНржпрж╛ржирж┐ржорзЗрж╢ржи рж╕ржоржирзНржмржпрж╝

```jsx
function expandCard() {
  flushSync(() => {
    setExpanded(true);
  });

  // DOM ржЖржкржбрзЗржЯрзЗрж░ ржкрж░ ржЕрзНржпрж╛ржирж┐ржорзЗрж╢ржи рж╢рзБрж░рзБ
  cardRef.current.animate([{ height: "100px" }, { height: "300px" }], {
    duration: 300,
  });
}
```

## ржХрж┐ ржХрж░рж╛ ржЙржЪрж┐ржд ржиржпрж╝

<Callout type="error" emoji="ЁЯЪл">
  **рж╕рж░рж╛рж╕рж░рж┐ DOM ржорзНржпрж╛ржирж┐ржкрзБрж▓рзЗржЯ ржХрж░ржмрзЗржи ржирж╛!** рж╕ржмрж╕ржоржпрж╝ React-ржХрзЗ DOM ржЖржкржбрзЗржЯ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржжрж┐ржиред
</Callout>

## ржЕржирзНржпрж╛ржирзНржп ржкржжрзНржзрждрж┐рж░ рж╕рж╛ржерзЗ рждрзБрж▓ржирж╛

<Tabs items={['flushSync', 'useLayoutEffect', 'setTimeout']}>
  <Tab>
    ```jsx
    // тЬЕ ржЕржмрж┐рж▓ржорзНржмрзЗ, рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕
    flushSync(() => {
      setState(newValue);
    });
    doSomethingWithDOM();
    ```
  </Tab>
  <Tab>
    ```jsx
    // тЪая╕П DOM ржЖржкржбрзЗржЯрзЗрж░ ржкрж░ ржЪрж▓рзЗ, ржХрж┐ржирзНрждрзБ ржЕрзНржпрж╛рж╕рж┐ржЩрзНржХрзНрж░рзЛржирж╛рж╕
    useLayoutEffect(() => {
      doSomethingWithDOM();
    }, [state]);
    ```
  </Tab>
  <Tab>
    ```jsx
    // тЭМ ржЕржмрж┐рж╢рзНржмрж╕рзНржд рж╕ржоржпрж╝
    setState(newValue);
    setTimeout(() => {
      doSomethingWithDOM(); // ржЦрзБржм рждрж╛ржбрж╝рж╛рждрж╛ржбрж╝рж┐ ржмрж╛ ржжрзЗрж░рж┐рждрзЗ рж╣рждрзЗ ржкрж╛рж░рзЗ
    }, 0);
    ```
  </Tab>
</Tabs>

## ржЖрж░ржУ ржЬрж╛ржирзБржи

ржЖрж░ржУ ржЧржнрзАрж░рзЗ ржпрзЗрждрзЗ ржкрзНрж░рж╕рзНрждрзБржд? ржПржЗ рж░рж┐рж╕рзЛрж░рзНрж╕ржЧрзБрж▓рж┐ ржжрзЗржЦрзБржи:

<Cards>
  <Card
    icon="ЁЯУЪ"
    title="ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ React ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи"
    href="https://react.dev/reference/react-dom/flushSync"
  >
    React ржЯрж┐ржо ржерзЗржХрзЗ flushSync-ржПрж░ ржирж┐рж░рзНржнрж░ржпрзЛржЧрзНржп ржЧрж╛ржЗржб
  </Card>
  <Card
    icon="ЁЯОУ"
    title="React DOM ржорзНржпрж╛ржирж┐ржкрзБрж▓рзЗрж╢ржи"
    href="https://react.dev/learn/manipulating-the-dom-with-refs"
  >
    рж░рзЗржл ржПржмржВ DOM ржорзНржпрж╛ржирж┐ржкрзБрж▓рзЗрж╢ржи рж╕ржорзНржкрж░рзНржХрзЗ ржЖрж░ржУ ржЬрж╛ржирзБржи
  </Card>
  <Card
    icon="тЪб"
    title="React ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕"
    href="https://react.dev/learn/render-and-commit"
  >
    React-ржПрж░ рж░рзЗржирзНржбрж╛рж░рж┐ржВ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржмрзЛржЭрж╛
  </Card>
</Cards>

---

<div className="text-center p-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
  <div className="text-4xl mb-4">ЁЯОЙ</div>
  <h3 className="text-2xl font-bold mb-2">ржПржЦржи ржЖржкржирж┐ ржПржХржЬржи flushSync ржмрж┐рж╢рзЗрж╖ржЬрзНржЮ!</h3>
  <div className="text-gray-600">
    ржорж╕рзГржг, ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛рж╢рзАрж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЕржнрж┐ржЬрзНржЮрждрж╛ рждрзИрж░рж┐ ржХрж░рждрзЗ ржПржЗ ржХрзНрж╖ржорждрж╛ ржмрж┐ржЪржХрзНрж╖ржгрждрж╛рж░ рж╕рж╛ржерзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред
  </div>
</div>

<style jsx>{`
  .hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: -2rem -2rem 3rem -2rem;
    color: white;
  }
`}</style>
